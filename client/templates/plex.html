<template name="plex">
    <div class="container">
        <div class="row">
            <div class="col-md-offset-2 col-md-8">
                {{#if currentUser }}
                    <h1>Plex Test Page</h1>
                    <p class="lead">This page is to help confirm that you can successfully communicate with Plex,
                        if you still have issues please post on the <a href="https://forums.plex.tv/index.php/topic/151899-plex-movie-requests/">forums</a> or the <a href="https://github.com/lokenx/plexrequests-meteor">GitHub repo</a>.</p>
                {{#each plexinfo}}
                    <p><strong>Username: </strong> {{username}}</p>
                    <p><strong>Password: </strong> {{password}}</p>
                    <p><strong>Connection status: </strong> <span class="plexInfo">Attempting to connect...please be patient</span> <span class="plexSuccess" style="display:none;"><i class="fa fa-check-circle"></i></span> <span class="plexError" style="display:none;"><i class="fa fa-exclamation-circle"></i></span> </p>
                <br>
                <br>

                {{/each}}

                {{else}}
                    <h1>You are not authorized to view this page.</h1>
                {{/if}}
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function () {
            Meteor.call('checkPlex', function(err, data) {
	            console.log(data);
                if (data) {
                    $('.plexInfo').text('Plex Server Authenticated');
                    $('.plexSuccess').removeAttr('style');
                } else {
	                $('.plexInfo').text("Plex.tv authentication failed. Check your Plex.tv username and password.");
                    $('.plexError').removeAttr('style');

                }
              });
        });
    </script>
</template>